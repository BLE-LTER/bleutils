<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Utility functions for BLE LTER IM team">
<title>Utility functions for BLE LTER IM team • bleutils</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Utility functions for BLE LTER IM team">
<meta property="og:description" content="Utility functions for BLE LTER IM team">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">bleutils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="bleutils">bleutils<a class="anchor" aria-label="anchor" href="#bleutils"></a>
</h1></div>
<p>October 25th 2022</p>
<div class="section level2">
<h2 id="orientation">Orientation<a class="anchor" aria-label="anchor" href="#orientation"></a>
</h2>
<p><code>bleutils</code> is a collection of R functions for use by the BLE LTER IM team.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation:<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<pre><code><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"BLE-LTER/bleutils"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="manipulating-core-program-data">Manipulating Core Program data<a class="anchor" aria-label="anchor" href="#manipulating-core-program-data"></a>
</h3>
<p>First, load the example data. <code>cp_data</code> is included with <code>bleutils</code> and is a minimal example of what investigators need to give the IM team before we can proceed.</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bleutils</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">cp_data</span></span></code></pre>
<div class="section level4">
<h4 id="adding-standard-columns-to-cp-data">Adding standard columns to CP data<a class="anchor" aria-label="anchor" href="#adding-standard-columns-to-cp-data"></a>
</h4>
<p><code>add_cp_cols</code> will add columns such as node, lagoon, lat/lon, etc… to a data.frame, provided a column of station codes, e.g. “EWLD1”. Use this to quickly add the required columns to a dataset.</p>
<pre><code><span><span class="fu"><a href="reference/add_cp_cols.html">add_cp_cols</a></span><span class="op">(</span><span class="va">df</span>, station_code_col <span class="op">=</span> <span class="st">"station"</span><span class="op">)</span></span></code></pre>
<p>Note that this function relies on the <code>stations</code> data.frame packaged with <code>bleutils</code>. The canon copy of this is kept on Box. To check if <code>bleutils</code> has the latest version, use <code>update_cp_stations</code> and point it to where Box is on your local machine. If the Box version differs from what <code>bleutils</code> has, this will update the package version. If this happens, make sure to push the change to GitHub and re-install <code>bleutils</code> wherever it is used.</p>
<pre><code><span><span class="fu"><a href="reference/update_cp_stations.html">update_cp_stations</a></span><span class="op">(</span>source_file <span class="op">=</span> <span class="st">"path_goes_here"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="inferring-sampling-season-based-on-dates">Inferring sampling season based on dates<a class="anchor" aria-label="anchor" href="#inferring-sampling-season-based-on-dates"></a>
</h4>
<p><code>infer_season</code> outputs a vector of categorical season values (under ice/break up/open water) from a vector of date values (column in data.frame).</p>
<pre><code><span><span class="va">df</span><span class="op">$</span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/infer_season.html">infer_season</a></span><span class="op">(</span><span class="va">df</span>, date_col <span class="op">=</span> <span class="st">"date_collected"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="order-data-columns">Order data columns<a class="anchor" aria-label="anchor" href="#order-data-columns"></a>
</h4>
<p>Order columns according to the standard BLE order. Check out the function documentation for the exact order depending on data type (water/sediment/mooring). Columns need to be named exactly as specified, so make sure that’s done before running this function.</p>
<pre><code><span><span class="fu"><a href="reference/order_cp_cols.html">order_cp_cols</a></span><span class="op">(</span><span class="va">df</span>, type <span class="op">=</span> <span class="st">"water"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="sort-data-rows">Sort data rows<a class="anchor" aria-label="anchor" href="#sort-data-rows"></a>
</h4>
<p>Order data rows according to the standard BLE order. Check out the function documentation for the exact order depending on data type (water/sediment/mooring). Columns need to be named exactly as specified, so make sure that’s done before running this function.</p>
<pre><code><span><span class="fu"><a href="reference/sort_cp_rows.html">sort_cp_rows</a></span><span class="op">(</span><span class="va">df</span>, type <span class="op">=</span> <span class="st">"water"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="other-useful-im-tasks">Other useful IM tasks<a class="anchor" aria-label="anchor" href="#other-useful-im-tasks"></a>
</h3>
<div class="section level4">
<h4 id="initializing-dataset">Initializing dataset<a class="anchor" aria-label="anchor" href="#initializing-dataset"></a>
</h4>
<p><code>init_datapkg</code> creates a directory structure and a templated R script for a new dataset. It will warn you if the dataset ID already exists (based on directory names in <code>base_path</code>) and messages the next available numeric ID.</p>
<pre><code><span><span class="fu"><a href="reference/init_datapkg.html">init_datapkg</a></span><span class="op">(</span>base_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             dataset_id <span class="op">=</span> <span class="fl">9999</span>,</span>
<span>             dataset_nickname <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="initializing-a-data-processing-script">Initializing a data processing script<a class="anchor" aria-label="anchor" href="#initializing-a-data-processing-script"></a>
</h4>
<p><code>init_script</code> creates a R script and populates it from template. For a new dataset, <code>init_datapkg</code> calls <code>init_script(type = "init")</code> and there’s no further action needed R script. For updating existing datasets, use the argument <code>type = "update"</code>.</p>
<pre><code><span><span class="fu"><a href="reference/init_script.html">init_script</a></span><span class="op">(</span>dataset_id <span class="op">=</span> <span class="fl">9999</span>,</span>
<span>            workdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"9999_test"</span>, <span class="st">"EML_generation"</span>, <span class="st">"2022"</span><span class="op">)</span>, </span>
<span>            type <span class="op">=</span> <span class="st">"update"</span><span class="op">)</span></span></code></pre>
<p>The main difference is that an update script also has code to pull the latest version of the dataset from EDI’s production server, so the new data can be appended to it.</p>
<p>The templates live in <code>inst/</code> if updates are needed.</p>
</div>
<div class="section level4">
<h4 id="appending-units-to-metadata-attribute-names">Appending units to metadata attribute names<a class="anchor" aria-label="anchor" href="#appending-units-to-metadata-attribute-names"></a>
</h4>
<p>We decided to append abbreviated units at the end of attribute names (see BLE handbook). To facilitate that, wrap calls to <code><a href="https://rdrr.io/pkg/MetaEgress/man/get_meta.html" class="external-link">MetaEgress::get_meta()</a></code> in <code><a href="reference/append_units.html">bleutils::append_units</a></code>. This saves us from having to actually have the units in attribute names in metabase, and makes updates easier.</p>
<pre><code>metadata &lt;- </code></pre>
</div>
<div class="section level4">
<h4 id="renaming-attributes-to-match-metadata">Renaming attributes to match metadata<a class="anchor" aria-label="anchor" href="#renaming-attributes-to-match-metadata"></a>
</h4>
<p>Quick convenience function to rename all columns in a data.frame to what’s in the metadata. The usual assumptions apply: that there are as many columns in data as in metadata, and they are ordered the same way.</p>
<pre><code># These following lines are commented out because they will not work without being able to connect to an instance of metabase
# metadata &lt;- MetaEgress::get_metadata(dbname = "ble_metabase", 
                                       dataset_ids = 13, 
                                       user = "insert_or_enter_in_console", 
                                       password = "insert_or_enter_in_console")
# df &lt;- rename_attributes(metadata,
                          dataset_id = 13,
                          entity = 1,
                          x = df,
                          append_units = TRUE)</code></pre>
</div>
<div class="section level4">
<h4 id="exporting-personnel-from-metabase-to-csv">Exporting personnel from metabase to CSV<a class="anchor" aria-label="anchor" href="#exporting-personnel-from-metabase-to-csv"></a>
</h4>
<p>BLE’s Core Program datasets include a CSV to personnel with the years of data they were involved in. This information is stored in metabase and is specific to BLE. <code><a href="https://rdrr.io/pkg/MetaEgress/man/get_meta.html" class="external-link">MetaEgress::get_meta()</a></code> doesn’t query this information, so use:</p>
<pre><code># These following lines are commented out because they will not work without being able to connect to an instance of metabase

# export_personnel(dataset_ids = 13,
                   file_name = "BLE_LTER_chlorophyll_personnel.csv")</code></pre>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://creativecommons.org/licenses/by/4.0" class="external-link">CC BY 4.0</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bleutils</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>An T. Nguyen <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by An T. Nguyen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
